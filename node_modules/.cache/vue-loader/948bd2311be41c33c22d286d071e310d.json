{"remainingRequest":"/Users/anusornmennakred/Documents/Vue/live-homepro-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/anusornmennakred/Documents/Vue/live-homepro-admin/src/views/LiveNow.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/anusornmennakred/Documents/Vue/live-homepro-admin/src/views/LiveNow.vue","mtime":1597657854064},{"path":"/Users/anusornmennakred/Documents/Vue/live-homepro-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/anusornmennakred/Documents/Vue/live-homepro-admin/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/anusornmennakred/Documents/Vue/live-homepro-admin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/anusornmennakred/Documents/Vue/live-homepro-admin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBBZ29yYVJUQyBmcm9tICJhZ29yYS1ydGMtc2RrLW5nIjsKaW1wb3J0IGZpcmViYXNlIGZyb20gImZpcmViYXNlIjsKaW1wb3J0IE1lc3NhZ2UgZnJvbSAiQC9jb21wb25lbnRzL01lc3NhZ2UiOwppbXBvcnQgVGltZXIgZnJvbSAiQC9jb21wb25lbnRzL1RpbWVyIjsKLy8gaW1wb3J0IExpdmVWaWV3ZXIgZnJvbSAiQC9jb21wb25lbnRzL0xpdmVWaWV3ZXIiOwoKY29uc3QgZGIgPSBmaXJlYmFzZS5maXJlc3RvcmUoKTsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiTGl2ZU5vdyIsCiAgY29tcG9uZW50czogewogICAgTWVzc2FnZSwKICAgIFRpbWVyCiAgICAvLyBMaXZlVmlld2VyCiAgfSwKICBwcm9wczogW10sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNsaWVudDoge30sCiAgICAgIGFsbE1lc3NhZ2U6IFtdLAogICAgICBzY3JvbGxQb3NpdGlvbjogMCwgLy8gcG9zaXRpb24gb2Ygc2Nyb2xsIGNoYXQgcGFuZWwKICAgICAgY2hhdEhlaWdodDogMCwgLy8gaGVpZ2h0IG9mIGNoYXQgcGFuZWwKICAgICAgc2Nyb2xsSGVpZ2h0OiAwLCAvLyBzY3JvbGxQb3NpdGlvbiArIGNoYXRIZWlnaHQKICAgICAgZW5kTGl2ZTogZmFsc2UsCiAgICAgIHNlY3Rpb25XaWR0aDogMCAvLyBkZWZpbmUgd2lkdGggb2YgdmlkZW8gbGl2ZQogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0Q2hhdCgpCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBqb2luQ2hhbmVsKCkgewogICAgICB0aGlzLmNsaWVudCA9IEFnb3JhUlRDLmNyZWF0ZUNsaWVudCh7bW9kZTogJ2xpdmUnLCBjb2RlYzogImgyNjQifSkKICAgIH0sCiAgICBnZXRDaGF0KCkgewogICAgICBkYi5jb2xsZWN0aW9uKCdDdXJyZW50TGl2ZScpLmRvYyh0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50T3B0aW9uLmNoYW5uZWwpLmNvbGxlY3Rpb24oJ0NoYXRzJykub3JkZXJCeSgidGltZVN0YW1wIiwpLm9uU25hcHNob3Qoc25hcHNob3QgPT4gewogICAgICAgIHNuYXBzaG90LmRvY0NoYW5nZXMoKS5mb3JFYWNoKGNoYW5nZSA9PiB7CiAgICAgICAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICdhZGRlZCcpIHsKICAgICAgICAgICAgbGV0IGRvYyA9IGNoYW5nZS5kb2M7CiAgICAgICAgICAgIHRoaXMuYWxsTWVzc2FnZS5wdXNoKHsKICAgICAgICAgICAgICBtZXNzYWdlOiBkb2MuZGF0YSgpLm1zZywKICAgICAgICAgICAgICB1c2VybmFtZTogZG9jLmRhdGEoKS51c2VybmFtZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2V0VGltZW91dCh0aGlzLnNjcm9sbFRvRW5kLCAxMDAwKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgc2Nyb2xsVG9FbmQoKSB7CiAgICAgIGxldCBjaGF0ID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiI2NoYXQiKTsKICAgICAgdGhpcy5jaGF0SGVpZ2h0ID0gY2hhdC5vZmZzZXRIZWlnaHQKICAgICAgY2hhdC5hZGRFdmVudExpc3RlbmVyKCJzY3JvbGwiLCB0aGlzLmhhbmRsZVNjcm9sbCk7CiAgICAgIGlmICh0aGlzLmNoYXRIZWlnaHQgKyB0aGlzLnNjcm9sbFBvc2l0aW9uID49IHRoaXMuc2Nyb2xsSGVpZ2h0IC0gNDApIHsKICAgICAgICBjaGF0LnNjcm9sbFRvcCA9IGNoYXQuc2Nyb2xsSGVpZ2h0OwogICAgICB9CiAgICAgIHRoaXMuc2Nyb2xsSGVpZ2h0ID0gY2hhdC5zY3JvbGxIZWlnaHQKICAgIH0sCiAgICBoYW5kbGVTY3JvbGwoZSkgewogICAgICB0aGlzLnNjcm9sbFBvc2l0aW9uID0gZS50YXJnZXQuc2Nyb2xsVG9wCiAgICB9LAogICAgbWF0Y2hIZWlnaHQoKSB7CiAgICAgIHRoaXMuc2VjdGlvbldpZHRoID0gdGhpcy4kcmVmcy5pbmZvQm94LmNsaWVudFdpZHRoOwogICAgICB0aGlzLiRzdG9yZS5zdGF0ZS5zZWN0aW9uTGl2ZVdpZHRoID0gdGhpcy4kcmVmcy5pbmZvQm94LmNsaWVudFdpZHRoCiAgICB9LAogICAgdG9FbmRMaXZlKCkgewogICAgICB0aGlzLiRzdG9yZS5zdGF0ZS5lbmRMaXZlID0gdHJ1ZQogICAgICBkYi5jb2xsZWN0aW9uKCdDdXJyZW50TGl2ZScpLmRvYyh0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50T3B0aW9uLmNoYW5uZWwpLmRlbGV0ZSgpLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICB0aXRsZTogJ1N1Y2Nlc3MnLAogICAgICAgICAgbWVzc2FnZTogJ0VuZCBMaXZlIENvbXBsZXRlJywKICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJwogICAgICAgIH0pOwogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0Q3VycmVudE9wdGlvbicsIG51bGwpCiAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICB0aXRsZTogJ0Vycm9yJywKICAgICAgICAgIG1lc3NhZ2U6IGUsCiAgICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgICAgfSk7CiAgICAgIH0pCiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5tYXRjaEhlaWdodCgpCiAgfSwKCn0K"},{"version":3,"sources":["LiveNow.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"LiveNow.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <div class=\"flex flex-wrap\">\n      <div id=\"define-width\" ref=\"infoBox\" class=\"bg-green-100 w-1/2\">\n        <div class=\"flex flex-wrap justify-between\">\n          <h1 class=\"text-3xl mb-6\">Start to Live</h1>\n          <div\n              @click=\"toEndLive()\"\n              style=\"height: 45px\"\n              class=\"text-xl items-baseline cursor-pointer bg-red-600 px-5 py-2 rounded-lg hover:bg-red-700 text-white\"\n          >\n            End Live\n            <span class=\"material-icons\" style=\"vertical-align: bottom;margin-bottom: 6px\">live_tv</span>\n          </div>\n        </div>\n        <div style=\"height:460px \"></div>\n        <Timer/>\n      </div>\n      <div class=\"bg-red-100 h-12 w-1/2 pl-5\">\n        <h1 class=\"text-xl mb-6 mt-2\">Comments</h1>\n        <div id=\"chat\" class=\"w-full overflow-auto\" style=\"height: 80vh;\">\n          <Message v-for=\"message in allMessage\" :key=\"message.id\" :message=\"message\"/>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport AgoraRTC from \"agora-rtc-sdk-ng\";\nimport firebase from \"firebase\";\nimport Message from \"@/components/Message\";\nimport Timer from \"@/components/Timer\";\n// import LiveViewer from \"@/components/LiveViewer\";\n\nconst db = firebase.firestore();\n\nexport default {\n  name: \"LiveNow\",\n  components: {\n    Message,\n    Timer\n    // LiveViewer\n  },\n  props: [],\n  data() {\n    return {\n      client: {},\n      allMessage: [],\n      scrollPosition: 0, // position of scroll chat panel\n      chatHeight: 0, // height of chat panel\n      scrollHeight: 0, // scrollPosition + chatHeight\n      endLive: false,\n      sectionWidth: 0 // define width of video live\n    }\n  },\n  created() {\n    this.getChat()\n  },\n  methods: {\n    async joinChanel() {\n      this.client = AgoraRTC.createClient({mode: 'live', codec: \"h264\"})\n    },\n    getChat() {\n      db.collection('CurrentLive').doc(this.$store.state.currentOption.channel).collection('Chats').orderBy(\"timeStamp\",).onSnapshot(snapshot => {\n        snapshot.docChanges().forEach(change => {\n          if (change.type === 'added') {\n            let doc = change.doc;\n            this.allMessage.push({\n              message: doc.data().msg,\n              username: doc.data().username\n            });\n            setTimeout(this.scrollToEnd, 1000);\n          }\n        });\n      });\n    },\n    scrollToEnd() {\n      let chat = this.$el.querySelector(\"#chat\");\n      this.chatHeight = chat.offsetHeight\n      chat.addEventListener(\"scroll\", this.handleScroll);\n      if (this.chatHeight + this.scrollPosition >= this.scrollHeight - 40) {\n        chat.scrollTop = chat.scrollHeight;\n      }\n      this.scrollHeight = chat.scrollHeight\n    },\n    handleScroll(e) {\n      this.scrollPosition = e.target.scrollTop\n    },\n    matchHeight() {\n      this.sectionWidth = this.$refs.infoBox.clientWidth;\n      this.$store.state.sectionLiveWidth = this.$refs.infoBox.clientWidth\n    },\n    toEndLive() {\n      this.$store.state.endLive = true\n      db.collection('CurrentLive').doc(this.$store.state.currentOption.channel).delete().then(() => {\n        this.$notify({\n          title: 'Success',\n          message: 'End Live Complete',\n          type: 'success'\n        });\n        this.$store.commit('setCurrentOption', null)\n      }).catch(e => {\n        this.$notify({\n          title: 'Error',\n          message: e,\n          type: 'error'\n        });\n      })\n    }\n  },\n  mounted() {\n    this.matchHeight()\n  },\n\n}\n</script>\n\n<style scoped>\n\n</style>"]}]}